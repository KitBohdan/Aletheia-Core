# VCT RoboDog — Voice Canine Trainer + RoboDog Brain

LLM-first стек для голосового дресирування собак із GPIO-диспенсером винагород і вбудованими етичними запобіжниками. VCT (Voice Canine Trainer) поєднує розпізнавання голосових команд, планування дій та контроль підгодовувача, аби автоматизувати тренування з урахуванням безпеки тварини.

## Зміст
- [Особливості](#особливості)
- [Вимоги](#вимоги)
- [Установка](#установка)
- [Швидкий старт](#швидкий-старт)
- [CLI](#cli)
- [REST API](#rest-api)
- [Змінні середовища](#змінні-середовища)
- [Розробка](#розробка)
- [Тести](#тести)
- [Структура проєкту](#структура-проєкту)
- [Ліцензія](#ліцензія)

## Особливості
- **LLM-first обробка команд.** Модуль `RoboDogBrain` виконує інтерпретацію голосових запитів, планування дій і формування текстово-аудіо відповіді.
- **Сучасне розпізнавання мовлення.** Whisper STT (OpenAI) забезпечує точне перетворення голосових команд у текст, з автоматичним фолбеком на rule-based режим.
- **Реалістичні голосові відповіді.** Інтегрований OpenAI TTS надає багатомовні природні голоси з можливістю вибору тембру; за відсутності доступу використовується локальний pyttsx3 або консольний режим.
- **GPIO-диспенсер винагород.** Модуль підтримує реальний пін керування або симуляцію для тестів без апаратури.
- **Етичні запобіжники.** Параметри довіри, настрою і «reward bias» дозволяють збалансувати нагороди та корегувати поведінку.
- **CLI та REST API.** Миттєвий запуск із командного рядка або інтеграція через FastAPI-сервіс.
- **Телеметрія.** Експозиція метрик через `prometheus-client` для моніторингу взаємодій.

## Вимоги
- Python 3.9+
- Система з доступом до GPIO (для фізичного диспенсера) або режим симуляції
- [pip](https://pip.pypa.io/), рекомендовано оновлену версію

## Установка
1. Клонуйте репозиторій та перейдіть у директорію проєкту.
2. (Необовʼязково) Створіть та активуйте віртуальне середовище: `python -m venv .venv && source .venv/bin/activate`.
3. Оновіть `pip` та встановіть пакет у режимі розробки:
   ```bash
   python -m pip install -U pip
   pip install -e .
   ```
4. Для додаткових інструментів розробника виконайте:
   ```bash
   pip install -r requirements-dev.txt
   ```
5. (Необовʼязково) Для високоточного розпізнавання мовлення встановіть Whisper:
   ```bash
   pip install openai-whisper
   ```

## Швидкий старт
Найшвидший спосіб перевірити роботу мозку RoboDog – симуляція без апаратури:
```bash
python -m vct.cli --simulate --cmd "сидіти"
```
Команда поверне JSON із рішенням мозку та рекомендованою дією.

## CLI
CLI інтерфейс знаходиться у модулі [`vct.cli`](vct/cli.py) і підтримує такі аргументи:

```bash
python -m vct.cli \
  --config vct/config.yaml \
  --cmd "лежати" \
  --gpio-pin 17 \
  --simulate
```

- `--config` – шлях до YAML-конфігурації (за замовчуванням `vct/config.yaml`).
- `--cmd` – текстова команда, якщо не використовується `--wav`.
- `--wav` – шлях до аудіофайла, який буде розпізнано та інтерпретовано.
- `--gpio-pin` – номер GPIO-піна для диспенсера винагород.
- `--simulate` – примусовий запуск без реального GPIO.

Без аргументів `--cmd/--wav` використовується команда «сидіти».

## REST API
Запустіть FastAPI застосунок:
```bash
uvicorn vct.api.app:app --reload --port 8000
```
Доступні кінцеві точки:

- `GET /health` – стан сервісу та режим симуляції.
- `POST /robot/act` – виконує дію на основі тіла запиту:
  ```json
  {
    "text": "дай лапу",
    "confidence": 0.92,
    "reward_bias": 0.4,
    "mood": 0.1
  }
  ```
  Відповідь міститиме поле `result` з рішенням мозку.

## Змінні середовища
REST API читає налаштування з наступних змінних:

- `VCT_CONFIG` – шлях до конфігурації (дефолт `vct/config.yaml`).
- `VCT_SIMULATE` – `1` для симуляції, інше значення вмикає GPIO.
- `VCT_GPIO_PIN` – номер GPIO-піна, `0` або порожнє значення вимикає фізичну видачу.
- `OPENAI_API_KEY` – ключ доступу до OpenAI Audio API для генерації голосових відповідей.
- `OPENAI_TTS_VOICE` – (необовʼязково) бажаний голос, наприклад `alloy`, `coral`, `ember`.
- `OPENAI_TTS_MODEL` – (необовʼязково) модель TTS, стандартно `gpt-4o-mini-tts`.
- `OPENAI_TTS_LANGUAGE` – (необовʼязково) мова синтезу, якщо відрізняється від автоматичного визначення.

## Розробка
- Вмикайте логування через `vct.utils.logging.get_logger` та дотримуйтеся стилю кодування (див. [`pyproject.toml`](pyproject.toml)).
- Для статичного аналізу використовується [Ruff](https://docs.astral.sh/ruff/):
  ```bash
  ruff check .
  ```
- Формат покриття тестів контролюється через pytest із `--cov`.

## Тести
Запуск тестового набору:
```bash
pytest
```
За замовчуванням виконується зниження рівня виводу (`-q`) та збір покриття.

## Структура проєкту
```
vct/
├─ api/           # REST API на FastAPI
├─ cli.py         # CLI-доступ до мозку RoboDog
├─ robodog/       # Реалізація мозку та роботи з диспенсером
└─ utils/         # Логування, допоміжні модулі
```

## Ліцензія
Проєкт поширюється під ліцензією MIT. Деталі – у файлі [LICENSE](LICENSE).
